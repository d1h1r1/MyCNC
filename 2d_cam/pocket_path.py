# import pyclipper
# from matplotlib import pyplot as plt
#
outer_points = [[39.673, 21.591], [38.913, 21.58], [38.066, 21.548], [37.145, 21.497], [36.167, 21.428],
                [35.146, 21.343], [34.097, 21.243], [33.035, 21.131], [31.975, 21.008], [30.931, 20.875],
                [30.931, 20.875], [30.931, 38.689], [30.931, 38.689], [30.896, 39.059], [30.797, 39.408],
                [30.639, 39.729], [30.429, 40.017], [30.173, 40.266], [29.876, 40.469], [29.546, 40.622],
                [29.188, 40.718], [28.808, 40.751], [28.808, 40.751], [15.918, 40.751], [15.918, 40.751],
                [15.532, 40.718], [15.162, 40.622], [14.817, 40.469], [14.503, 40.266], [14.23, 40.017],
                [14.003, 39.729], [13.832, 39.408], [13.724, 39.059], [13.686, 38.689], [13.686, 38.689],
                [13.686, -33.492], [13.686, -33.492], [13.704, -34.009], [13.771, -34.464], [13.902, -34.863],
                [14.115, -35.213], [14.426, -35.522], [14.852, -35.797], [15.409, -36.043], [16.115, -36.268],
                [16.985, -36.48], [16.985, -36.48], [19.093, -36.951], [21.353, -37.399], [23.746, -37.814],
                [26.248, -38.188], [28.84, -38.513], [31.501, -38.78], [34.209, -38.981], [36.944, -39.108],
                [39.684, -39.153], [39.684, -39.153], [45.149, -38.798], [50.023, -37.748], [54.293, -36.025],
                [57.945, -33.652], [60.963, -30.65], [63.336, -27.041], [65.047, -22.847], [66.085, -18.091],
                [66.433, -12.795], [66.433, -12.795], [66.433, -4.767], [66.433, -4.767], [66.102, 0.394],
                [65.121, 5.078], [63.485, 9.25], [61.19, 12.876], [58.231, 15.92], [54.605, 18.349], [50.306, 20.127],
                [45.33, 21.219], [39.673, 21.591]]


inner_points = [[49.156, -12.806], [49.08, -15.166], [48.831, -17.354], [48.379, -19.34], [47.692, -21.098],
                [46.741, -22.599], [45.495, -23.815], [43.921, -24.718], [41.991, -25.28], [39.673, -25.474],
                [39.673, -25.474], [38.514, -25.463], [37.385, -25.432], [36.294, -25.383], [35.247, -25.319],
                [34.252, -25.242], [33.316, -25.154], [32.446, -25.059], [31.648, -24.958], [30.931, -24.853],
                [30.931, -24.853], [30.931, 7.27], [30.931, 7.27], [31.82, 7.368], [32.771, 7.459], [33.766, 7.54],
                [34.787, 7.611], [35.817, 7.671], [36.838, 7.72], [37.833, 7.756], [38.784, 7.778], [39.673, 7.786],
                [39.673, 7.786], [41.991, 7.592], [43.921, 7.031], [45.495, 6.131], [46.741, 4.92], [47.692, 3.428],
                [48.379, 1.683], [48.831, -0.285], [49.08, -2.448], [49.156, -4.777], [49.156, -4.777],
                [49.156, -12.806]]
#


out = [[-4.833, -9.107], [-2.304, -7.956], [0.056, -6.523], [2.214, -4.802], [4.135, -2.791], [5.784, -0.483], [7.127, 2.124], [8.129, 5.035], [8.755, 8.255], [8.971, 11.788], [8.971, 11.788], [8.971, 13.144], [8.971, 13.144], [8.466, 18.853], [7.003, 23.688], [4.665, 27.702], [1.531, 30.95], [-2.316, 33.487], [-6.797, 35.365], [-11.83, 36.64], [-17.334, 37.365], [-23.228, 37.594], [-23.228, 37.594], [-25.841, 37.572], [-28.51, 37.507], [-31.191, 37.404], [-33.837, 37.268], [-36.402, 37.103], [-38.842, 36.913], [-41.11, 36.702], [-43.16, 36.476], [-44.946, 36.238], [-44.946, 36.238], [-45.983, 36.046], [-46.889, 35.804], [-47.665, 35.495], [-48.315, 35.101], [-48.84, 34.604], [-49.245, 33.985], [-49.53, 33.227], [-49.7, 32.312], [-49.755, 31.22], [-49.755, 31.22], [-49.755, -38.896], [-49.755, -38.896], [-49.721, -39.271], [-49.621, -39.625], [-49.462, -39.951], [-49.251, -40.243], [-48.992, -40.495], [-48.693, -40.702], [-48.36, -40.857], [-47.998, -40.954], [-47.613, -40.988], [-47.613, -40.988], [-33.71, -40.988], [-33.71, -40.988], [-33.326, -40.954], [-32.964, -40.857], [-32.63, -40.702], [-32.331, -40.495], [-32.073, -40.243], [-31.861, -39.951], [-31.702, -39.625], [-31.603, -39.271], [-31.568, -38.896], [-31.568, -38.896], [-31.568, -12.353], [-31.568, -12.353], [-30.846, -12.36], [-30.049, -12.378], [-29.195, -12.405], [-28.305, -12.437], [-27.397, -12.471], [-26.49, -12.503], [-25.604, -12.53], [-24.758, -12.548], [-23.972, -12.555], [-23.972, -12.555], [-22.791, -12.449], [-22.791, -12.449], [-8.462, -38.885], [-8.462, -38.885], [-8.286, -39.232], [-8.112, -39.571], [-7.931, -39.892], [-7.737, -40.188], [-7.522, -40.449], [-7.281, -40.668], [-7.004, -40.834], [-6.686, -40.94], [-6.32, -40.978], [-6.32, -40.978], [10.043, -40.978], [10.043, -40.978], [10.409, -40.959], [10.721, -40.904], [10.984, -40.815], [11.198, -40.696], [11.368, -40.548], [11.495, -40.375], [11.583, -40.179], [11.633, -39.962], [11.649, -39.728], [11.649, -39.728], [11.645, -39.621], [11.633, -39.506], [11.613, -39.384], [11.585, -39.257], [11.55, -39.126], [11.507, -38.99], [11.456, -38.853], [11.398, -38.714], [11.332, -38.575], [11.332, -38.575], [-4.833, -9.107]]

inner = [[-9.216, 11.788], [-9.353, 9.578], [-9.785, 7.672], [-10.547, 6.058], [-11.674, 4.726], [-13.199, 3.662], [-15.157, 2.855], [-17.582, 2.294], [-20.509, 1.965], [-23.972, 1.859], [-23.972, 1.859], [-24.504, 1.862], [-25.27, 1.873], [-26.203, 1.89], [-27.237, 1.912], [-28.303, 1.939], [-29.336, 1.969], [-30.269, 2.002], [-31.035, 2.037], [-31.568, 2.072], [-31.568, 2.072], [-31.568, 22.134], [-31.568, 22.134], [-30.994, 22.173], [-30.172, 22.216], [-29.17, 22.262], [-28.057, 22.307], [-26.901, 22.35], [-25.772, 22.387], [-24.737, 22.417], [-23.867, 22.437], [-23.228, 22.444], [-23.228, 22.444], [-20.382, 22.335], [-17.837, 22.005], [-15.602, 21.449], [-13.688, 20.664], [-12.102, 19.645], [-10.852, 18.388], [-9.949, 16.888], [-9.401, 15.142], [-9.216, 13.144], [-9.216, 13.144], [-9.216, 11.788]]

import numpy as np
import matplotlib.pyplot as plt
from shapely.geometry import Polygon


def generate_offset_ring(outer, inner, offset_dist, num_samples=100):
    """
    获取不规则环状区域沿边偏移的点云
    :param outer: shapely Polygon，外边界
    :param inner: shapely Polygon，内边界
    :param offset_dist: 偏移距离
    :param num_samples: 采样点数量
    :return: 偏移后的点坐标列表
    """
    # 外轮廓向内偏移，内轮廓向外偏移
    outer_offset = outer.buffer(-offset_dist)  # 向内收缩
    inner_offset = inner.buffer(offset_dist)  # 向外扩张
    # inner_offset = inner

    ring = Polygon(outer_offset.exterior, [inner_offset.exterior])

    # 获取偏移后的边界点
    points = []
    for line in [ring.exterior]:
        coords_list = list(line.coords)  # 转换为列表
        sample_indices = np.linspace(0, len(coords_list) - 1, num_samples, dtype=int)
        for i in sample_indices:
            points.append(coords_list[i])  # 这里用列表索引，避免 Shapely 的错误
    print(points)
    return np.array(points), ring  # 返回点云和新的偏移区域


# 创建不规则环形区域
outer_boundary = Polygon(out)
inner_boundary = Polygon(inner)

# 设置偏移距离
offset_distance = 8
num_samples = 200  # 采样点数

# 生成偏移点云
offset_points, new_ring = generate_offset_ring(outer_boundary, inner_boundary, offset_distance, num_samples)

# 绘制原始和偏移后的区域
fig, ax = plt.subplots()
ax.plot(*outer_boundary.exterior.xy, 'b-', label="原外边界")
ax.plot(*inner_boundary.exterior.xy, 'r-', label="原内边界")

ax.plot(*new_ring.exterior.xy, 'g--', label="偏移后外边界")
for inner in new_ring.interiors:
    ax.plot(*inner.xy, 'm--', label="偏移后内边界")

ax.scatter(offset_points[:, 0], offset_points[:, 1], c='g', s=5, label="偏移点云")
ax.set_aspect('equal')
ax.legend()
plt.show()
