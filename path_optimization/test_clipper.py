import pyclipper
import math
import matplotlib.pyplot as plt

# 示例轮廓（矩形）
outer = [(-20.8, 25.8), (-13.864, 25.8), (-14.432, 25.421), (-14.616, 25.288), (-14.925, 25.046), (-15.082, 24.914), (-15.161, 24.842), (-15.232, 24.785), (-15.265, 24.756), (-15.276, 24.746), (-15.438, 24.604), (-15.695, 24.36), (-15.709, 24.346), (-15.733, 24.323), (-15.741, 24.314), (-15.75, 24.305), (-15.754, 24.301), (-15.887, 24.164), (-15.891, 24.159), (-16.093, 23.949), (-16.2, 23.831), (-16.456, 23.534), (-16.592, 23.364), (-17.06, 22.734), (-17.187, 22.549), (-17.397, 22.217), (-17.504, 22.033), (-17.848, 21.393), (-17.899, 21.294), (-17.925, 21.241), (-17.999, 21.08), (-17.999, 21.079), (-18.132, 20.781), (-18.19, 20.639), (-18.331, 20.273), (-18.379, 20.141), (-18.503, 19.768), (-18.567, 19.549), (-18.757, 18.788), (-18.802, 18.573), (-18.869, 18.186), (-18.899, 17.966), (-18.908, 17.872), (-18.923, 17.775), (-18.948, 17.556), (-18.98, 17.145), (-18.985, 17.07), (-18.986, 17.051), (-18.988, 16.959), (-18.989, 16.959), (-18.999, 16.603), (-19.0, 16.518), (-18.999, 10.929), (-18.976, 10.558), (-18.958, 10.414), (-18.914, 10.158), (-18.849, 9.906), (-18.791, 9.717), (-18.705, 9.474), (-18.598, 9.239), (-18.531, 9.107), (-18.405, 8.883), (-18.26, 8.67), (-18.142, 8.512), (-17.974, 8.307), (-17.789, 8.118), (-17.678, 8.014), (-17.481, 7.845), (-17.27, 7.693), (-17.193, 7.642), (-17.123, 7.596), (-16.871, 7.446), (-16.658, 7.347), (-16.659, 7.345), (-16.523, 7.286), (-16.314, 7.204), (-16.099, 7.139), (-15.956, 7.101), (-15.677, 7.04), (-15.393, 7.007), (-15.107, 7.001), (-14.821, 7.022), (-14.576, 7.052), (-14.332, 7.092), (-14.092, 7.153), (-13.858, 7.232), (-13.796, 7.256), (-13.785, 7.261), (-13.614, 7.328), (-13.389, 7.427), (-13.172, 7.544), (-12.967, 7.678), (-12.866, 7.75), (-12.854, 7.758), (-12.754, 7.83), (-12.564, 7.98), (-12.386, 8.144), (-12.384, 8.146), (-12.206, 8.339), (-12.18, 8.37), (-12.178, 8.373), (-12.045, 8.532), (-11.828, 8.826), (-11.649, 9.144), (-11.593, 9.259), (-11.587, 9.271), (-11.536, 9.377), (-11.393, 9.729), (-11.392, 9.732), (-11.32, 9.986), (-11.295, 10.091), (-11.293, 10.097), (-11.203, 10.478), (-11.136, 10.677), (-11.126, 10.702), (-11.055, 10.841), (-10.976, 10.98), (-10.964, 10.998), (-10.886, 11.096), (-10.828, 11.169), (-10.741, 11.259), (-10.649, 11.346), (-10.483, 11.473), (-10.463, 11.486), (-10.285, 11.586), (-10.21, 11.618), (-9.959, 11.471), (-9.722, 11.346), (-9.164, 11.084), (-8.893, 10.973), (-8.313, 10.767), (-8.096, 10.699), (-7.798, 10.618), (-7.588, 10.569), (-6.991, 10.452), (-6.838, 10.426), (-6.831, 10.425), (-6.689, 10.408), (-6.075, 10.35), (-5.783, 10.337), (-5.167, 10.339), (-4.87, 10.355), (-4.257, 10.418), (-4.038, 10.449), (-3.735, 10.503), (-3.514, 10.551), (-3.453, 10.566), (-3.388, 10.579), (-3.248, 10.611), (-3.24, 10.613), (-3.16, 10.634), (-2.856, 10.719), (-2.645, 10.786), (-2.571, 10.813), (-2.508, 10.832), (-2.303, 10.903), (-2.006, 11.018), (-1.791, 11.113), (-1.79, 11.112), (-1.234, 11.378), (-0.977, 11.517), (-0.456, 11.832), (-0.344, 11.903), (-0.338, 11.907), (-0.251, 11.967), (-0.196, 12.006), (-0.025, 12.128), (0.097, 12.219), (0.345, 12.414), (0.566, 12.606), (0.868, 12.895), (1.049, 13.037), (1.256, 13.169), (1.503, 13.295), (1.567, 13.321), (1.822, 13.406), (2.063, 13.46), (2.305, 13.49), (2.57, 13.496), (2.742, 13.482), (2.921, 13.46), (3.163, 13.405), (3.43, 13.316), (3.474, 13.298), (3.759, 13.153), (3.808, 13.123), (4.077, 12.931), (4.538, 12.555), (4.815, 12.354), (5.347, 12.013), (5.618, 11.859), (10.306, 9.501), (10.312, 9.498), (10.322, 9.493), (10.462, 9.427), (10.725, 9.312), (10.99, 9.211), (11.273, 9.118), (11.573, 9.036), (11.603, 9.03), (11.683, 9.008), (11.785, 8.989), (11.842, 8.977), (12.195, 8.921), (12.282, 8.912), (12.372, 8.899), (12.658, 8.876), (12.674, 8.874), (12.675, 8.874), (12.731, 8.87), (12.823, 8.868), (12.823, 8.872), (12.931, 8.871), (12.93, 8.867), (13.038, 8.865), (13.343, 8.874), (13.439, 8.882), (13.439, 8.886), (13.532, 8.892), (13.532, 8.89), (13.601, 8.895), (13.65, 8.9), (13.656, 8.901), (13.663, 8.902), (13.808, 8.917), (13.815, 8.918), (13.892, 8.932), (13.925, 8.936), (14.223, 8.99), (14.513, 9.058), (14.795, 9.139), (15.077, 9.235), (15.292, 9.318), (15.299, 9.321), (15.439, 9.385), (15.606, 9.467), (15.829, 9.576), (15.853, 9.588), (15.857, 9.59), (16.158, 9.763), (16.407, 9.926), (16.428, 9.94), (16.434, 9.944), (16.707, 10.149), (17.031, 10.423), (17.215, 10.593), (17.22, 10.598), (17.223, 10.601), (17.305, 10.692), (17.308, 10.69), (17.506, 10.904), (17.615, 11.038), (17.654, 11.081), (17.698, 11.139), (17.742, 11.193), (17.775, 11.238), (17.881, 11.377), (18.048, 11.624), (18.196, 11.865), (18.337, 12.123), (18.411, 12.284), (18.427, 12.314), (18.453, 12.374), (18.5, 12.475), (18.519, 12.524), (18.578, 12.658), (18.683, 12.944), (18.713, 13.029), (18.714, 13.032), (18.792, 13.317), (18.793, 13.316), (18.799, 13.34), (18.799, 13.342), (18.799, 13.344), (18.892, 13.751), (18.952, 14.117), (18.981, 14.406), (18.996, 14.701), (19.0, 17.116), (18.979, 17.479), (18.884, 18.269), (18.848, 18.491), (18.771, 18.882), (18.738, 19.033), (18.641, 19.419), (18.602, 19.56), (18.486, 19.942), (18.461, 20.019), (18.455, 20.037), (18.412, 20.156), (18.412, 20.157), (18.316, 20.42), (18.266, 20.558), (18.254, 20.588), (18.234, 20.638), (18.228, 20.652), (18.097, 20.966), (18.038, 21.099), (17.867, 21.459), (17.797, 21.597), (17.608, 21.947), (17.526, 22.089), (17.297, 22.463), (17.181, 22.638), (17.121, 22.722), (17.062, 22.815), (16.936, 22.995), (16.697, 23.313), (16.607, 23.427), (16.353, 23.733), (16.202, 23.902), (15.648, 24.475), (15.479, 24.637), (15.166, 24.914), (15.061, 25.002), (15.03, 25.027), (14.964, 25.079), (14.378, 25.525), (14.135, 25.692), (13.96, 25.8), (20.8, 25.8), (20.8, -25.8), (-20.8, -25.8), (-20.8, 25.8)]


# 刀具半径
tool_radius = 3
# 偏移步距
stepover = tool_radius * 0.4

# 保存所有偏移层
offsets = []

# 当前轮廓
current = outer
pc = pyclipper.PyclipperOffset()

# 生成向内偏移的路径层
while True:
    pc.Clear()
    pc.AddPath(current, pyclipper.JT_MITER, pyclipper.ET_CLOSEDPOLYGON)
    solution = pc.Execute(-stepover)
    if not solution:
        break
    current = solution[0]
    offsets.append(current)

# -------------------------------
# ✅ 可视化
# -------------------------------
plt.figure(figsize=(8, 4))

# 绘制外轮廓
x, y = zip(*outer)
plt.plot(x + (x[0],), y + (y[0],), 'k-', linewidth=2, label='outer')

# 绘制内偏移路径
for i, path in enumerate(offsets):
    xs, ys = zip(*path)
    plt.plot(xs + (xs[0],), ys + (ys[0],), '-o', label=f'offset {i+1}')

plt.axis('equal')
plt.legend()
plt.title("CNC Offset Paths (Inward)")
plt.show()
